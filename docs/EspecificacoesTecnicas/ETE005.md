# Especificação Técnica 005 - Atribuir Perfil de Acesso

## Descrição
Como usuário quero atribuir um perfil de acesso às funcionalidades do sistema para outro usuário. 

## Protótipo 001
[inserir imagem]

### Acesso
Controle de acesso > Moderar acesso > Consultar permissões de acesso > “Novo”

### Critérios de Aceite 
1. O usuário somente poderá acessar a funcionalidade caso tenha permissão; [RGN001](DocumentoDeRegrasv2.md#rgn001)
2. O sistema deve permitir a atribuição de perfis conforme tabela a seguir: 

      |                        | Instalador | Administrador | Gestor | Gestor de Estabelecimento | Farmacêutico | Atendente | Administrativo | Personalizados |
      | ---------------------- | :--------: | :-----------: | :----: | :-----------------------: | :----------: | :-------: | :------------: | :------------: |
      | Instalador             |            | X             |        |                           |              |           |                |                |
      | Administrador          |            | X             | X      |                           |              |           |                |                |
      | Gestor                 |            |               | X      | X                         | X            | X         | X              | X              |
      | Gestor Estabelecimento |            |               |        | X                         | X            | X         | X              | X              |

      - A leitura da tabela é feita da seguinte forma, os perfis da primeira coluna são os responsáveis pela atribuição dos demais perfis (ex: Perfil Administrador somente pode atribuir perfis de Administrador e Gestor)
      - Usuário com perfil "Gestor" poderá atribuir perfis de acesso para qualquer estabelecimento vinculado ao seu Ente;
      - Usuário com perfil de “Gestor Estabelecimento” poderá atribuir perfis de acesso somente para seu estabelecimento;
      - Perfis Personalizados não poderão atribuir ou moderar outros perfis;
      - O sistema deverá permitir perfis de acesso iguais para o mesmo usuário em Entes e/ou estabelecimentos diferentes; 
      - À um usuário que ainda não possui cadastro para acesso ao sistema. [RGN054](DocumentoDeRegrasv2.md#rgn054) 

3. Um perfil deverá ser atribuído de acordo com o contexto em que o usuário está inserido conforme segue:

      |                        | Global | Ente | Estabelecimento |
      | ---------------------- | :----: | :--: | :-------------: |
      | Administrador          | X      |      |                 |
      | Gestor                 |        | X    |                 |
      | Gestor Estabelecimento |        |      | X               |
      | Farmacêutico           |        |      | X               |
      | Atendente              |        |      | X               |
      | Administrativo         |        |      | X               |
      | Personalizados         |        |      | X               |

      - O perfil Instalador não consta na tabela pois ele não pode ser atribuído para nenhum usuário;

4. A aplicação não exercerá qualquer controle sobre perfis personalizados, devendo o usuário que atribui o perfil personalizado ter ciência de quais permissões estão atreladas a este perfil e o contexto ao qual o mesmo se propõe a atender;
5. O sistema não deverá permitir atribuir mais de um perfil de acesso por estabelecimento; [RGN054](DocumentoDeRegrasv2.md#rgn054) [MSG085](DocumentoDeMensagensv2.md#msg085)  
6. No campo “UF” o sistema deve recuperar e apresentar as unidades federativas participantes da instância;
7. No campo “Município” o sistema deve recuperar e apresentar a relação dos municípios vinculados à UF informada;
8. No campo “Estabelecimento” o sistema deve recuperar e apresentar a relação dos estabelecimentos vinculados a UF e/ou Município informados; 
9. Quando o usuário acionar a opção “Atribuir”, o sistema deve atribuir o perfil de acesso ao sistema, gravar o estado do registro como “Ativo” e a situação como “Aprovado”, envia um e-mail informativo ao solicitante, apresentar a mensagem de sucesso e retornar para a tela de consultar permissões de acesso; [MSG082](DocumentoDeMensagensv2.md#msg082) [MSG086](DocumentoDeMensagensv2.md#msg086)
10. Quando o usuário acionar a opção de “Limpar”, o sistema deve limpar os dados informados e permanece na tela de atribuir perfil.
11. Quando o usuário acionar a opção de “Voltar” ou “Consultar”, o sistema deve apresentar a mensagem de alerta ao usuário. Caso confirme a ação, retorna à tela de consulta aos meus perfis e não salva os dados preenchidos. Caso a ação não seja confirmada, permanece na tela de solicitar perfil; [MSG006](DocumentoDeMensagensv2.md#msg006)
12. O sistema deve gravar a data, hora e CPF e nome do usuário que a executou qualquer ação de alteração no estado do registro. [RGN005](DocumentoDeRegrasv2.md#rgn005)
