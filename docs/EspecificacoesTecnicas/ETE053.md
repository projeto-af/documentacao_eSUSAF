# ETE053- Cadastrar dispensação/fornecimento <!-- Estou criando do zero este .md de acordo com o docx. -->

## Descrição
Como usuário, quero cadastrar uma nova dispensação/fornecimento de produto(s) ao Usuário SUS, no estabelecimento de saúde logado. 

## Protótipo 001  

### Descrição resumida 
Cadastrar dispensação/fornecimento - Dados da dispensação/fornecimento: Etapa para cadastrar os dados do usuário SUS e Responsável pera retirada. 

[Inserir imagem]

### Acesso 
Menu lateral > Movimentação > Dispensação/Fornecimento > Cadastrar 

### Campos 

- Número da dispensação/fornecimento - gerado de forma automática pelo sistema 
Dados do usuário SUS: 
- CPF/CNS - obrigatório 
    - Nome completo – inserido de forma automática após o preenchimento do campo CPF/CNS 
    - Nome social - inserido de forma automática após o preenchimento do campo CPF/CNS 
    - Sexo - inserido de forma automática após o preenchimento do campo CPF/CNS 
    - Data de nascimento - inserido de forma automática após o preenchimento do campo CPF/CNS 

Identificação do responsável pela retirada: 
- Retirado por: 
    - Usuário SUS 
    - Responsável legal 
    - Outros 
- CPF/CNS - obrigatório 
- Nome completo - obrigatório 

### Critérios de Aceite 

1. O usuário somente poderá acessar a funcionalidade caso tenha permissão;  
2. Esta funcionalidade estará disponível apenas para usuários cadastrados no sistema como Farmacêutico, Gestor do estabelecimento ou Atendente do estabelecimento logado; 
3. Quando o usuário acessar a funcionalidade, o sistema deve apresentar a tela contendo os seguintes campos: 
    - Nº da Dispensação: Este número será gerado de forma automática pelo sistema e será o “ID” da dispensação. 
    - Dados do Usuário SUS: 
        A) CPF/CNS: Preenchendo o número do documento, as demais informações do Usuário SUS serão buscadas na base de dados do sistema (banco local), ou da integração com o CADSUS (banco nacional), que irá atualizar a base local:  
        -  Caso o sistema não localize um Usuário SUS através da informação do número de CPF/CNS, este deverá ser previamente cadastrado no sistema; 
        - Apresentar uma mensagem de alerta ao usuário caso a consulta não retorne um Usuário SUS válido; 
        - Apresentar uma mensagem de alerta ao usuário caso a consulta retorne um Usuário SUS com registro de óbito 
        B) Nome Completo: será preenchido de forma automática após a informação do CPF/CNS  
        C) Nome Social: será preenchido de forma automática após a informação do CPF/CNS, se aplicável  
        D) Sexo biológico/nascimento: será preenchido de forma automática após a informação do CPF/CNS  
        E) Data de Nascimento: será preenchido de forma automática após a informação do CPF/CNS 
        - Identificação do Responsável pela Retirada: 
        A) Retirado por: as opções listadas serão “Usuário SUS”, “Responsável Legal”, “Outros”:  
        - Por padrão, serão trazidos os dados do “Usuário SUS”, preenchidos nos “Dados do Usuário”, onde as informações do usuário serão replicadas nos próximos campos. 
        - No caso de um Usuário SUS menor de idade, incapaz, ou demais situações em que seu Responsável Legal esteja realizando a retirada, deverá ser marcada a opção “Responsável Legal”, onde serão trazidas as informações de Responsável (is) Legal (is) vinculado(s) ao Usuário SUS, através da busca do registro da base local ou da base nacional.  
        - No caso de mais de um Responsável Legal cadastrado, o sistema deverá listar todas as opções para o operador selecione o nome do Responsável que está presencialmente realizando a retirada. Assim, os demais dados de identificação do responsável serão preenchidos automaticamente. 
        - Se a retirada for feita por outro responsável que não esteja vinculado ao Usuário SUS, deverá ser marcada a opção “Outros”, onde para esta, os demais dados de identificação de responsável deverão ser preenchidas pelo operador do sistema. 
        B) CPF/CNS: Quando selecionado em “Retirado por” as opções “Usuário SUS” ou “Responsável Legal”, o número do documento será preenchido de forma automática, pela busca às bases:  
        - Se for selecionada a opção “Outros”, um dos documentos (CPF/CNS) deverá ser digitado. 
        C) Nome Completo: Quando selecionado em “Retirado por” as opções “Usuário SUS” ou “Responsável Legal”, o campo será preenchido de forma automática, pela busca às bases:  
        - Se for selecionada a opção “Outros”, o nome completo do responsável deverá ser digitado, conforme documento. 
4. O preenchimento desta tela com as informações de Usuário SUS e o Responsável pela Retirada são obrigatórios para prosseguir avançar nas etapas da dispensação.  
5. Os ícones localizados na parte superior/centralizada da tela ficariam habilitados para navegação apenas após os dados serem salvos. 
6. Ao clicar no botão “VOLTAR”, nenhum dado será gravado, e retornará para a telade consulta. 
7. Ao clicar em “Salvar e avançar” o sistema deve validar se todas as informações foram preenchidas. Se alguma informação obrigatória não foi inserida, o sistema sinaliza qual informação está faltando ser preenchida. Se estiver tudo de acordo, o sistema avança para a próxima etapa, e o registro será criado. 
8. Caso o usuário saia da tela de dispensação, após o registro criado, esses dados estarão salvos na tela de consulta com o status “Em preenchimento”, podendo dar prosseguimento ao preenchimento dos dados, sem perder as informações já salvas.  

## Protótipo 002 

### Descrição resumida 
Cadastrar dispensação/fornecimento - Dados da prescrição: Etapa para cadastrar os dados do de uma prescrição e as condições clínicas do Usuário SUS. 

[Inserir imagem]

### Acesso 
Menu lateral > Movimentação > Dispensação/Fornecimento > Cadastrar > Salvar e avançar 

### Campos 

Dados da prescrição: 
- Data da receita/prescrição - obrigatório 
- Registro eletrônico - opcional, para quando a receita for emitida de forma eletrônica 

Dados do prescritor: 
- CPF/CNS - obrigatório 
- Nome completo - obrigatório 
- Conselho de Classe  
    - Conselho Regional de Enfermagem 
    - Conselho Regional de Farmácia 
    - Conselho Regional de Fisioterapia e Terapia Ocupacional 
    - Conselho Regional de Medicina 
    - Conselho Regional de Odontologia 
    - Registro do Ministério da Saúde (Programa Mais Médicos) 
- UF do conselho - obrigatório 
- Número do Conselho - obrigatório 
- N° RQE - obrigatório apenas se informado a opção Especialidades médica 
- Especialidades médicas 
1. Acupuntura 
2. Alergia e imunologia 
3. Anestesiologia 
4. Angiologia 
5. Cardiologia 
6. Cirurgia cardiovascular 
7. Cirurgia da mão 
8. Cirurgia de cabeça e pescoço 
9. Cirurgiado aparelho digestivo 
10. Cirurgia geral 
11. Cirurgia oncológica 
12. Cirurgia pediátrica 
13. Cirurgia plástica 
14. Cirurgia torácica 
15. Cirurgia vascular 
16. Clínica médica 
17. Coloproctologia 
18. Dermatologia 
19. Endocrinologia e metabologia 
20. Endoscopia 
21. Gastroenterologia 
22. Genética médica 
23. Geriatria 
24. Ginecologia e obstetrícia 
25. Hematologia e hemoterapia 
26. Homeopatia 
27. Infectologia 
28. Mastologia 
29. Medicina de emergência 
30. Medicina de família e comunidade 
31. Medicina do trabalho 
32. Medicina do tráfego 
33. Medicina esportiva 
34. Medicina física e reabilitação 
35. Medicina intensiva 
36. Medicina legal e perícia médica 
37. Medicina nuclear 
38. Medicina preventiva e social 
39. Nefrologia 
40. Neurocirurgia 
41. Neurologia 
42. Nutrologia 
43. Oftalmologia 
44. Oncologiaclínica 
45. Ortopedia e traumatologia 
46. Otorrinolaringologia 
47. Patologia 
48. Patologiaclínica/medicina laboratorial 
49. Pediatria 
50. Pneumologia 
51. Psiquiatria 
52. Radiologia e diagnóstico por imagem 
53. Radioterapia 
54. Reumatologia 
55. Urologia 

- CNES Estabelecimento - obrigatório 
- UF – preenchido automaticamente pelo sistema após informar o CNES Estabelecimento 
- Nome do estabelecimento - preenchido automaticamente pelo sistema após informar o CNES Estabelecimento 

Condições Clínicas do Usuário: 
- Tipo 
- CIAP 
- CID-10 
- Buscar por - obrigatório 

|Tipo|Código|Condição clínica|Ações|
|----|------|----------------|-----|
|    |      |                |Excluir|

### Critérios de Aceite 

1. O usuário somente poderá acessar a funcionalidade caso tenha permissão;  
2. Esta funcionalidade estará disponível apenas para usuários cadastrados como Farmacêutico, Gestor de estabelecimento ou Atendente do estabelecimento logado. 
3. Esta tela só está disponível após o preenchimento dos dados obrigatórios do Protótipo 001; 
4. Quando o usuário acessar a funcionalidade, o sistema deve apresentar a tela contendo os seguintes campos: 
    A) Data da Receita/Prescrição: Será informada a data que consta na receita/prescrição do medicamento. O operador poderá digitar os números, ou clicar no ícone do calendário que fica à direita, para preenchimento deste campo.  
    - Apresentar uma mensagem de alerta ao usuário caso seja inserida uma data posterior à atual; 
    - Não é permitido cadastro de receita com data futura. 
    B) Registro Eletrônico: No caso de prescrições eletrônicas, neste campo será informado o token/código da receita. Este campo não é obrigatório, no momento, e deve ser no formato alfanumérico.  
    C) CPF/CNS: Neste, deverá ser informado o documento do prescritor.  
    D)  Nome Completo: Deverá ser preenchido o nome completo do prescritor, sem abreviações. Campo obrigatório.  
    E) Conselho de classe: Campo onde será selecionado em qual conselho de classe o prescritor está inscrito, dentre as opções:  
    - Conselho Regional de Enfermagem 
    - Conselho Regional de Farmácia 
    - Conselho Regional de Fisioterapia e Terapia Ocupacional 
    - Conselho Regional de Medicina 
    - Conselho Regional de Odontologia 
    - Registro do Ministério da Saúde (Programa Mais Médicos) 
    F) Número do Conselho: Deverá ser digitado o número de registro do conselho de classe ao qual o prescritor está inscrito.  
    G) UF do Conselho: Campo para selecionar em qual unidade federativa o prescritor está inscrito em seu conselho de classe.  
    H) Número do RQE: Quando o profissional possuir especialidade médica, nomeado como Registro de Qualificação de Especialista (RQE), deverá ser digitado o número deste registro.  
    I) Especialidade médica: Quando informado um RQE, este campo se tornará obrigatório, onde deverá ser selecionada uma especialidade médica dentre as 55 opções disponíveis (RESOLUÇÃO CFM nº 2.380, DE 18 DE JUNHO DE 2024).  
    J) CNES: Deverá ser informado o número do Cadastro Nacional de Estabelecimentos de Saúde onde ocorreu a prescrição.  
    - Se o número do CNES informado for inválido, o sistema irá acusar com mensagem. 
    K) UF do Estabelecimento: após a informação do CNES, essa informação é carregada automaticamente ao clicar na lupa.  
    L) Nome do Estabelecimento: após a informação do CNES, essa informação é carregada automaticamente ao clicar na lupa.  
    M) Tipo: Será necessário selecionar uma das opções entre CID-10 ou CIAP.  
    N) Condição Clínica: De acordo com a seleção do “Tipo”, esse campo permitirá a busca pelo código da CID-10 ou CIAP ou ainda, pelo nome da condição clínica.  
    -  A busca inicia quando digitado pelo menos 3 caracteres (autocompleta). 
    - Quando clicar na linha contendo a informação desejada (ex.: K71.2 – Doença hepática tóxica com hepatite aguda), automaticamente será destinada à lista. 
    - Quando a condição clínica for incluída na lista, o campo ficará limpo, podendo ser localizada outra condição clínica. 
    - Caso a condição clínica incluída não seja a correta, clicando no ícone de lixeira, localizado à direita da tela, o registro será excluído. 
5. Os ícones localizados na parte superior/centralizada da tela ficariam habilitados para navegação apenas após os dados serem salvos. 
6. Ao clicar no botão “Voltar”, nenhum dado será gravado, e retornará para a tela “Dados da Dispensação/Fornecimento” 
7. Ao clicar em “Salvar e avançar” o sistema deve validar se todas as informações foram preenchidas. Se alguma informação obrigatória não foi inserida, o sistema sinaliza qual informação está faltando ser preenchida. Se estiver tudo de acordo, o sistema avança para a próxima etapa. 
8. Caso o usuário saia da tela de dispensação, após o registro criado, esses dados estarão salvos na tela de consulta com o status “Em preenchimento”, podendo dar prosseguimento ao preenchimento dos dados, sem perder as informações já salvas. 

## Protótipo 003 

### Descrição resumida 
Cadastrar dispensação/fornecimento - Dados da dispensação/fornecimento: Etapa para cadastrar os itens e quantidades de uma prescrição. 

### Acesso 
Menu lateral > Movimentação > Dispensação/Fornecimento > Cadastrar > Salvar e avançar 

### Campos 

- Buscar por 
- Produto 
- Apresentação 
- Status 
- Quantidade prescrita 
- Quantidade dispensada/fornecida 
- Fabricante 
- Nº do lote 
- Data de validade 
- Quantidade em estoque 
- Qtd dispensada/fornecida (2) 
- Programa de saúde 
- Endereçamento físico 
- Quantidade em estoque (2) 
- Justificativa 

| Descrição do produto | Qtd prescrita | Qtd dispensada/fornecida | Status | Ações |
|----------------------|---------------|--------------------------|--------|-------|
|        |         |         |Atendimento total|Editar|
|        |         |         |Atendimento parcial|Excluir|
|        |         |         |Não atendido|    |


### Critérios de Aceite 

1. O usuário somente poderá acessar a funcionalidade caso tenha permissão;  
2. Esta funcionalidade estará disponível apenas para usuários cadastrados como Farmacêutico, Gestor de estabelecimento ou Atendente do estabelecimento logado. 
3. Após o preenchimento das informações do Protótipo 002, ao clicar em Salvar e avançar, o sistema deve apresentar a tela contendo os seguintes campos: 
    - Buscar por produto: o operador irá selecionar o produto a ser dispensado. Ao digitar pelo menos 3 caracteres, a lista (autocomplete) trará as opções disponíveis. 
    - A busca poderá ser realizada pelo nome do produto (conforme denominação comum brasileira) ou sua marca comercial. 
4.  Ao selecionar o produto desejado, irá abrir um modal com as informações do produto, contendo os seguintes campos: 
    A) Produto: Reporta o nome completo do produto escolhido, contendo o princípio ativo e sua concentração. Ex.: Isoniazida 150mg + Rifampicina 300mg. 
    - A ordenação apresentada, quando possuir estoque, será sempre pela validade do produto, trazendo o com validade mais curta, acima. 
    B) Apresentação: Como alguns produtos são fabricados na mesma concentração em diferentes formas farmacêuticas, esta informação se torna importante para a conferência do produto a ser dispensado. Este dado está atrelado ao cadastro do produto (movimentação de entrada). Assim, quando o produto é selecionado no campo anterior, essa informação será replicada da base. 
    C) Status: Esse campo irá informar três situações que podem ocorrer no atendimento da demanda: “Não Atendido”, “Atendimento parcial” e “Atendimento total”. 
    - Não atendido: Sempre que não for possível realizar uma dispensação, seja por falta de estoque ou por outra questão técnica que impossibilitar utilizar o medicamento em estoque, a “Quantidade Dispensada” será zero. Assim, a demanda não será atendida e o Status reportará esse não atendimento, com justificativa obrigatória. 
    - Atendimento Parcial: Nas situações em que não será possível dispensar a quantidade total de produto solicitada (“Quantidade prescrita” - “Quantidade Dispensada” > 0) teremos este status, onde a justificativa torna-se obrigatória. 
    - Atendimento Total: Quando eu tenho estoque disponível e consigo utilizá-lo pata atender toda a quantidade solicitada (“Quantidade prescrita” - “Quantidade Dispensada” = 0), realizando a entrega total do produto. Como terei o atendimento integral do produto, não caberá justificativa 
    - O campo será automaticamente preenchido considerando as informações de “Quantidade prescrita” e “Quantidade dispensada”. 
    D) Quantidade prescrita: Deverá ser informada a quantidade prescrita do produto, em função da posologia e do tempo de tratamento. Esse cálculo fica a cargo do farmacêutico ou atendente. Deverá ser informada sempre a menor unidade de distribuição (ex.: por comprimido, frasco, bisnaga, ampola, etc.).  
    E) Quantidade dispensada/fornecida: Esse campo será automaticamente preenchido (não permite digitação) de acordo com a informação fornecida pelo operador no campo “Quantidade dispensada/fornecida” relacionada ao lote específico. Ela nunca poderá ser maior que a quantidade informada no campo “Quantidade prescrita”. 
    
    Os campos “Fabricante”, “Lote”, “Data Validade”, “Quantidade estoque”, “Programa de Saúde” e “Endereço físico”, serão informações replicadas da posição de estoque em tempo real. Esses campos não permitem edição. 
    F) Quantidade dispensada/fornecida: Esse campo se repete na tela. Neste caso campo é digitável, permitindo que o operador insira um valor que não ultrapasse a “Quantidade estoque”, e seja menor ou igual à “Quantidade prescrita”. 
    - Caso seja informada uma quantidade superior à “Quantidade prescrita”, o sistema irá sinalizar o operador com mensagem; 
    - Mesmo havendo quantidade em estoque, o operador pode desejar não realizar o atendimento, deixando o campo zerado e clicando em incluir, cabendo nesse caso a justificativa, uma vez que será uma demanda assumirá o status de “Não atendida”. 
    G) Justificativa: Esse campo texto só irá ser obrigatório quando o Status estiver como “Não atendido” e “Atendimento parcial”. 
5. Ao clicar no botão “Salvar” as informações registradas no modal serão salvas e reportadas para a tela “Dados dos Dispensados”, na forma de lista. 
6. Ao clicar no botão “Cancelar”, não salvará nenhuma informação e retornará para a tela “Dados da Dispensação/Fornecimento”. 
7. Serão listadas todas as informações salvas do preenchimento do modal: 
    - Descrição do produto 
    - Quantidade prescrita 
    - Quantidade dispensada 
    - Status 
8. A tela contará com dois botões de ação: Editar e Excluir: 
    - Ao clicar no ícone “Editar” será reaberto o modal para edição das informações já salvas. 
    - Ao clicar em Excluir, a informação daquele produto será excluída. O sistema irá alertar o operador com mensagem. Se clicar em “SIM”, o registro do produto será excluído. Se clicar em “NÃO”, retorna para a tela “Dados dos Dispensados” 
9. O operador pode incluir quantos produtos forem necessários, realizando novamente a busca por Produto nesta tela.  
10. Quando finalizar a adição dos produtos, clicar no botão “Salvar e avançar”, o operador será direcionado para a próxima etapa. 
11. Os ícones localizados na parte superior/centralizada da tela ficariam habilitados para navegação apenas após os dados serem salvos. 
12. Ao clicar no botão “Voltar”, e retornará para a tela “Dados da prescrição”  
13. Ao clicar em “Salvar e avançar” o sistema deve validar se todas as informações foram preenchidas. É necessário no mínimo o registro de um produto. Caso tente avançar sem o registro de um produto o sistema sinaliza com mensagem. Se estiver tudo de acordo, o sistema avança para a próxima etapa. 
14. Caso o usuário saia da tela de dispensação, após o registro criado, esses dados estarão salvos na tela de consulta com o status “Em preenchimento”, podendo dar prosseguimento ao preenchimento dos dados, sem perder as informações já salvas. 

## Protótipo 004 

### Descrição resumida 
Cadastrar dispensação/fornecimento - Finalização: Etapa onde serão revisados os dados da dispensação/fornecimento antes de finalizar o processo.  

[Inserir imagem]

### Acesso 
Menu lateral > Movimentação > Dispensação/Fornecimento > Cadastrar > Salvar e avançar 

### Campos 

Etapa 1 - Dados do Usuário SUS: 
- N° da Dispensação/Fornecimento 
- CPF/CNS 
- Nome completo 
- Nome social 
- Sexo 
- Data de nascimento 
- Retirado por 
- CPF/CNS 
- Nome completo 

Etapa 2 - Dados da prescrição: 
- Data da receita/prescrição 
- Registro eletrônico 
- CPF/CNS 
- Nome completo 
- Conselho de Classe 
- Número do Conselho 
- UF do Conselho 
- N° RQE 
    - Especialidades médicas 
    - CNES 
    - UF 
    - Nome do estabelecimento 
    - Tipo 
    - Código 
    - Condição clínica 

Etapa 3 - Dados da Dispensação/Fornecimento: 
- Produto 
- Apresentação 
- Qtd prescrita 
- Qtd dispensada/fornecida 
- Status 
- Justificativa 

### Critérios de Aceite 

1. O usuário somente poderá acessar a funcionalidade caso tenha permissão;  
2. Esta funcionalidade estará disponível apenas para usuários cadastrados como Farmacêutico, Gestor de estabelecimento ou Atendente do estabelecimento logado. 
3. Quando o usuário estiver nesta tela, o sistema deve apresentá-la contendo os seguintes campos: 
    - Dados gerais para revisão: Resume todas as informações preenchidas em uma única tela para conferência do operador. 
4. Caso algum dado obrigatório não tenha sido preenchido, o sistema irá informar qual o dado que está inconsistente, e disponibilizar um botão que direcionará para a etapa com inconsistência, para correto preenchimento. 
5. Para concluir a dispensação, deverá ser clicado no botão “Confirmar dispensação”. 
6. O botão “Confirmar Dispensação” só ficará habilitado quando não existir nenhuma inconsistência de dados. 
7. Após clicar em “Confirmar Dispensação” o sistema irá gravar todos os dados da dispensação e realizar todas as movimentações de saída no sistema, assim como irá guardar os dados de data, hora e operador e estabelecimento responsável pela dispensação. 
8. Ao finalizar o processo, o sistema irá direcionar para a tela de consulta. 

 